% Beamer slide template prepared by Tom Clark <tom.clark@op.ac.nz>
% Otago Polytechnic
% Dec 2012

\documentclass[10pt]{beamer}
\usetheme{CambridgeUS}
\usepackage{graphicx}
\usepackage{fancyvrb}
\usepackage{sidecap}


\title{Rest Resources in some more depth}

\author[IN705]{Databases Three}
\institute[Otago Polytechnic]{
  Otago Polytechnic \\
  Dunedin, New Zealand \\
}
\date{}
\begin{document}

%----------- titlepage ----------------------------------------------%
\begin{frame}[plain]
  \titlepage
\end{frame}




%----------- slide --------------------------------------------------%
\begin{frame}
  \frametitle{We know so far}

 \begin{itemize}
  \item We can create a \$resource object with a RESTful URL scheme.
  \item This lets us access a RESTful resource that presents a typical
        REST API.
  \item We can add custom methods to access other parts of our API.
  \item We need be be attentive to \emph{Cross-origin resource sharing} (CORS) issues.  
 \end{itemize}

\end{frame}


%----------- slide --------------------------------------------------%
\begin{frame}[fragile]
  \frametitle{So, we can do this:}

 \begin{verbatim}
 app.factory('User', function($resource) {
    return $resource('http://someurl/users/:id.json')});

 ... later ...

  user = User.get({id: 1});

 \end{verbatim}

\end{frame}



%----------- slide --------------------------------------------------%
\begin{frame}[fragile]
  \frametitle{Creating a new user}

 \begin{verbatim}
  user = new User({name:'John Doe'});
  user.$save();

OR
 
 User.save({},user);
 \end{verbatim}

\end{frame}


%----------- slide --------------------------------------------------%
\begin{frame}
  \frametitle{Problem 1: CORS issues}

 \begin{itemize}
  \item Once you start doing something like a POST, you may run into CORS problems.
  \item If you see your server getting an OPTIONS request, that's a CORS issue.
  \item One method: \url{http://blog.rudylee.com/2013/10/29/rails-4-cors/}
 \end{itemize}

\end{frame}


%----------- slide --------------------------------------------------%
\begin{frame}[fragile]
  \frametitle{Another CORS approach: in JS}

 \begin{verbatim}
  app.config(['$httpProvider', function($httpProvider) {
    $httpProvider.defaults.headers.common = {};
    $httpProvider.defaults.headers.post = {};
    $httpProvider.defaults.headers.put = {};
  }]);
 \end{verbatim}

\end{frame}



%----------- slide --------------------------------------------------%
\begin{frame}
  \frametitle{Problem 2: POST/PUT payloads}

 \begin{itemize}
  \item Our JSON data should be going into the payloads of our POST or PUT 
        requests.
  \item However, I've run into problems where this data isn't showing up.
 \end{itemize}
\end{frame}


%----------- slide --------------------------------------------------%
\begin{frame}[fragile]
  \frametitle{Custom methods}
 We also want to be able to add custom methods for our resources.
 \begin{verbatim}
 app.factory('User', function($resource) {
    return $resource('http://someurl/users/:id.json', {},
      {update: {method:'PUT', url:'http://someurl/users/:id.json'}}
    )});

  Then we can call 

  User.update({id: 1}, {user: data});
  
 \end{verbatim}


\end{frame}


\end{document}
